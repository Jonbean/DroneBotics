from controller import *
import mavic2proHelper
from simple_pid import PID
import csv
import struct

params = dict()
with open("../params.csv", "r") as f:
    lines = csv.reader(f)
    for line in lines:
        params[line[0]] = line[1]

TIME_STEP = int(params["QUADCOPTER_TIME_STEP"])
TAKEOFF_THRESHOLD_VELOCITY = int(params["TAKEOFF_THRESHOLD_VELOCITY"])
M_PI = 3.1415926535897932384626433

robot = Robot()

[frontLeftMotor, frontRightMotor, backLeftMotor, backRightMotor] = mavic2proHelper.getMotorAll(robot)

timestep = int(robot.getBasicTimeStep())
mavic2proMotors = mavic2proHelper.getMotorAll(robot)
mavic2proHelper.initialiseMotors(robot, 0)
mavic2proHelper.motorsSpeed(robot, TAKEOFF_THRESHOLD_VELOCITY, TAKEOFF_THRESHOLD_VELOCITY, TAKEOFF_THRESHOLD_VELOCITY, TAKEOFF_THRESHOLD_VELOCITY)

front_left_led = LED("front left led")
front_right_led = LED("front right led")
gps = GPS("gps")
gps.enable(TIME_STEP)
imu = InertialUnit("inertial unit")
imu.enable(TIME_STEP)
compass = Compass("compass")
compass.enable(TIME_STEP)
gyro = Gyro("gyro")
gyro.enable(TIME_STEP)

yaw_setpoint=-1

pitchPID = PID(float(params["pitch_Kp"]), float(params["pitch_Ki"]), float(params["pitch_Kd"]), setpoint=0.0)
rollPID = PID(float(params["roll_Kp"]), float(params["roll_Ki"]), float(params["roll_Kd"]), setpoint=0.0)
throttlePID = PID(float(params["throttle_Kp"]), float(params["throttle_Ki"]), float(params["throttle_Kd"]), setpoint=1)
yawPID = PID(float(params["yaw_Kp"]), float(params["yaw_Ki"]), float(params["yaw_Kd"]), setpoint=float(yaw_setpoint))

targetX, targetY, target_altitude = 1.0, 0.0, 10.0


#######
# This is where the output of the drone_path function could be used
# (in the wavefront_master.py)
#######
print("It's working.")
list = [(0, 0), (0.0, 0.0), (-0.44, 0.0), (-0.89, 0.0), (-1.33, 0.0), (-1.78, 0.0), (-2.22, 0.0), (-2.67, 0.0), (-3.11, 0.0), (-3.56, 0.0), (-4.0, 0.0), (-4.0, 0.0), (-4.11, 0.11), (-4.22, 0.22), (-4.33, 0.33), (-4.44, 0.44), (-4.56, 0.56), (-4.67, 0.67), (-4.78, 0.78), (-4.89, 0.89), (-5.0, 1.0), (-5.0, 1.0), (-5.11, 1.11), (-5.22, 1.22), (-5.33, 1.33), (-5.44, 1.44), (-5.56, 1.56), (-5.67, 1.67), (-5.78, 1.78), (-5.89, 1.89), (-6.0, 2.0), (-6.0, 2.0), (-6.11, 2.11), (-6.22, 2.22), (-6.33, 2.33), (-6.44, 2.44), (-6.56, 2.56), (-6.67, 2.67), (-6.78, 2.78), (-6.89, 2.89), (-7.0, 3.0), (-7.0, 3.0), (-7.11, 3.11), (-7.22, 3.22), (-7.33, 3.33), (-7.44, 3.44), (-7.56, 3.56), (-7.67, 3.67), (-7.78, 3.78), (-7.89, 3.89), (-8.0, 4.0), (-8.0, 4.0), (-8.11, 4.11), (-8.22, 4.22), (-8.33, 4.33), (-8.44, 4.44), (-8.56, 4.56), (-8.67, 4.67), (-8.78, 4.78), (-8.89, 4.89), (-9.0, 5.0), (-9.0, 5.0), (-9.0, 4.89), (-9.0, 4.78), (-9.0, 4.67), (-9.0, 4.56), (-9.0, 4.44), (-9.0, 4.33), (-9.0, 4.22), (-9.0, 4.11), (-9.0, 4.0), (-9.0, 4.0), (-9.0, 3.89), (-9.0, 3.78), (-9.0, 3.67), (-9.0, 3.56), (-9.0, 3.44), (-9.0, 3.33), (-9.0, 3.22), (-9.0, 3.11), (-9.0, 3.0), (-9.0, 3.0), (-9.0, 2.89), (-9.0, 2.78), (-9.0, 2.67), (-9.0, 2.56), (-9.0, 2.44), (-9.0, 2.33), (-9.0, 2.22), (-9.0, 2.11), (-9.0, 2.0), (-9.0, 2.0), (-9.0, 1.89), (-9.0, 1.78), (-9.0, 1.67), (-9.0, 1.56), (-9.0, 1.44), (-9.0, 1.33), (-9.0, 1.22), (-9.0, 1.11), (-9.0, 1.0), (-9.0, 1.0), (-9.0, 0.89), (-9.0, 0.78), (-9.0, 0.67), (-9.0, 0.56), (-9.0, 0.44), (-9.0, 0.33), (-9.0, 0.22), (-9.0, 0.11), (-9.0, 0.0), (-9.0, 0.0), (-8.89, 0.0), (-8.78, 0.0), (-8.67, 0.0), (-8.56, 0.0), (-8.44, 0.0), (-8.33, 0.0), (-8.22, 0.0), (-8.11, 0.0), (-8.0, 0.0), (-8.0, 0.0), (-8.0, 0.11), (-8.0, 0.22), (-8.0, 0.33), (-8.0, 0.44), (-8.0, 0.56), (-8.0, 0.67), (-8.0, 0.78), (-8.0, 0.89), (-8.0, 1.0), (-8.0, 1.0), (-8.0, 1.11), (-8.0, 1.22), (-8.0, 1.33), (-8.0, 1.44), (-8.0, 1.56), (-8.0, 1.67), (-8.0, 1.78), (-8.0, 1.89), (-8.0, 2.0), (-8.0, 2.0), (-8.0, 2.11), (-8.0, 2.22), (-8.0, 2.33), (-8.0, 2.44), (-8.0, 2.56), (-8.0, 2.67), (-8.0, 2.78), (-8.0, 2.89), (-8.0, 3.0), (-8.0, 3.0), (-7.89, 2.89), (-7.78, 2.78), (-7.67, 2.67), (-7.56, 2.56), (-7.44, 2.44), (-7.33, 2.33), (-7.22, 2.22), (-7.11, 2.11), (-7.0, 2.0), (-7.0, 2.0), (-7.0, 1.89), (-7.0, 1.78), (-7.0, 1.67), (-7.0, 1.56), (-7.0, 1.44), (-7.0, 1.33), (-7.0, 1.22), (-7.0, 1.11), (-7.0, 1.0), (-7.0, 1.0), (-7.0, 0.89), (-7.0, 0.78), (-7.0, 0.67), (-7.0, 0.56), (-7.0, 0.44), (-7.0, 0.33), (-7.0, 0.22), (-7.0, 0.11), (-7.0, 0.0), (-7.0, 0.0), (-6.89, 0.0), (-6.78, 0.0), (-6.67, 0.0), (-6.56, 0.0), (-6.44, 0.0), (-6.33, 0.0), (-6.22, 0.0), (-6.11, 0.0), (-6.0, 0.0), (-6.0, 0.0), (-6.0, 0.11), (-6.0, 0.22), (-6.0, 0.33), (-6.0, 0.44), (-6.0, 0.56), (-6.0, 0.67), (-6.0, 0.78), (-6.0, 0.89), (-6.0, 1.0), (-6.0, 1.0), (-5.89, 0.89), (-5.78, 0.78), (-5.67, 0.67), (-5.56, 0.56), (-5.44, 0.44), (-5.33, 0.33), (-5.22, 0.22), (-5.11, 0.11), (-5.0, 0.0), (-5.0, 0.0), (-4.89, 0.11), (-4.78, 0.22), (-4.67, 0.33), (-4.56, 0.44), (-4.44, 0.56), (-4.33, 0.67), (-4.22, 0.78), (-4.11, 0.89), (-4.0, 1.0), (-4.0, 1.0), (-4.11, 1.11), (-4.22, 1.22), (-4.33, 1.33), (-4.44, 1.44), (-4.56, 1.56), (-4.67, 1.67), (-4.78, 1.78), (-4.89, 1.89), (-5.0, 2.0), (-5.0, 2.0), (-5.11, 2.11), (-5.22, 2.22), (-5.33, 2.33), (-5.44, 2.44), (-5.56, 2.56), (-5.67, 2.67), (-5.78, 2.78), (-5.89, 2.89), (-6.0, 3.0), (-6.0, 3.0), (-6.11, 3.11), (-6.22, 3.22), (-6.33, 3.33), (-6.44, 3.44), (-6.56, 3.56), (-6.67, 3.67), (-6.78, 3.78), (-6.89, 3.89), (-7.0, 4.0), (-7.0, 4.0), (-7.11, 4.11), (-7.22, 4.22), (-7.33, 4.33), (-7.44, 4.44), (-7.56, 4.56), (-7.67, 4.67), (-7.78, 4.78), (-7.89, 4.89), (-8.0, 5.0), (-8.0, 5.0), (-8.11, 5.11), (-8.22, 5.22), (-8.33, 5.33), (-8.44, 5.44), (-8.56, 5.56), (-8.67, 5.67), (-8.78, 5.78), (-8.89, 5.89), (-9.0, 6.0), (-9.0, 6.0), (-9.0, 6.11), (-9.0, 6.22), (-9.0, 6.33), (-9.0, 6.44), (-9.0, 6.56), (-9.0, 6.67), (-9.0, 6.78), (-9.0, 6.89), (-9.0, 7.0), (-9.0, 7.0), (-9.0, 7.11), (-9.0, 7.22), (-9.0, 7.33), (-9.0, 7.44), (-9.0, 7.56), (-9.0, 7.67), (-9.0, 7.78), (-9.0, 7.89), (-9.0, 8.0), (-9.0, 8.0), (-9.0, 8.11), (-9.0, 8.22), (-9.0, 8.33), (-9.0, 8.44), (-9.0, 8.56), (-9.0, 8.67), (-9.0, 8.78), (-9.0, 8.89), (-9.0, 9.0), (-9.0, 9.0), (-8.89, 8.89), (-8.78, 8.78), (-8.67, 8.67), (-8.56, 8.56), (-8.44, 8.44), (-8.33, 8.33), (-8.22, 8.22), (-8.11, 8.11), (-8.0, 8.0), (-8.0, 8.0), (-8.0, 8.11), (-8.0, 8.22), (-8.0, 8.33), (-8.0, 8.44), (-8.0, 8.56), (-8.0, 8.67), (-8.0, 8.78), (-8.0, 8.89), (-8.0, 9.0), (-8.0, 9.0), (-7.89, 8.89), (-7.78, 8.78), (-7.67, 8.67), (-7.56, 8.56), (-7.44, 8.44), (-7.33, 8.33), (-7.22, 8.22), (-7.11, 8.11), (-7.0, 8.0), (-7.0, 8.0), (-6.89, 8.11), (-6.78, 8.22), (-6.67, 8.33), (-6.56, 8.44), (-6.44, 8.56), (-6.33, 8.67), (-6.22, 8.78), (-6.11, 8.89), (-6.0, 9.0), (-6.0, 9.0), (-5.89, 9.0), (-5.78, 9.0), (-5.67, 9.0), (-5.56, 9.0), (-5.44, 9.0), (-5.33, 9.0), (-5.22, 9.0), (-5.11, 9.0), (-5.0, 9.0), (-5.0, 9.0), (-4.89, 9.0), (-4.78, 9.0), (-4.67, 9.0), (-4.56, 9.0), (-4.44, 9.0), (-4.33, 9.0), (-4.22, 9.0), (-4.11, 9.0), (-4.0, 9.0), (-4.0, 9.0), (-3.89, 9.0), (-3.78, 9.0), (-3.67, 9.0), (-3.56, 9.0), (-3.44, 9.0), (-3.33, 9.0), (-3.22, 9.0), (-3.11, 9.0), (-3.0, 9.0), (-3.0, 9.0), (-2.89, 9.0), (-2.78, 9.0), (-2.67, 9.0), (-2.56, 9.0), (-2.44, 9.0), (-2.33, 9.0), (-2.22, 9.0), (-2.11, 9.0), (-2.0, 9.0), (-2.0, 9.0), (-1.89, 9.0), (-1.78, 9.0), (-1.67, 9.0), (-1.56, 9.0), (-1.44, 9.0), (-1.33, 9.0), (-1.22, 9.0), (-1.11, 9.0), (-1.0, 9.0), (-1.0, 9.0), (-0.89, 9.0), (-0.78, 9.0), (-0.67, 9.0), (-0.56, 9.0), (-0.44, 9.0), (-0.33, 9.0), (-0.22, 9.0), (-0.11, 9.0), (0.0, 9.0), (0.0, 9.0), (0.0, 8.89), (0.0, 8.78), (0.0, 8.67), (0.0, 8.56), (0.0, 8.44), (0.0, 8.33), (0.0, 8.22), (0.0, 8.11), (0.0, 8.0), (0.0, 8.0), (-0.11, 8.0), (-0.22, 8.0), (-0.33, 8.0), (-0.44, 8.0), (-0.56, 8.0), (-0.67, 8.0), (-0.78, 8.0), (-0.89, 8.0), (-1.0, 8.0), (-1.0, 8.0), (-1.11, 8.0), (-1.22, 8.0), (-1.33, 8.0), (-1.44, 8.0), (-1.56, 8.0), (-1.67, 8.0), (-1.78, 8.0), (-1.89, 8.0), (-2.0, 8.0), (-2.0, 8.0), (-2.11, 8.0), (-2.22, 8.0), (-2.33, 8.0), (-2.44, 8.0), (-2.56, 8.0), (-2.67, 8.0), (-2.78, 8.0), (-2.89, 8.0), (-3.0, 8.0), (-3.0, 8.0), (-3.11, 8.0), (-3.22, 8.0), (-3.33, 8.0), (-3.44, 8.0), (-3.56, 8.0), (-3.67, 8.0), (-3.78, 8.0), (-3.89, 8.0), (-4.0, 8.0), (-4.0, 8.0), (-4.11, 8.0), (-4.22, 8.0), (-4.33, 8.0), (-4.44, 8.0), (-4.56, 8.0), (-4.67, 8.0), (-4.78, 8.0), (-4.89, 8.0), (-5.0, 8.0), (-5.0, 8.0), (-5.11, 8.0), (-5.22, 8.0), (-5.33, 8.0), (-5.44, 8.0), (-5.56, 8.0), (-5.67, 8.0), (-5.78, 8.0), (-5.89, 8.0), (-6.0, 8.0), (-6.0, 8.0), (-6.11, 8.11), (-6.22, 8.22), (-6.33, 8.33), (-6.44, 8.44), (-6.56, 8.56), (-6.67, 8.67), (-6.78, 8.78), (-6.89, 8.89), (-7.0, 9.0), (-7.0, 9.0), (-6.89, 8.89), (-6.78, 8.78), (-6.67, 8.67), (-6.56, 8.56), (-6.44, 8.44), (-6.33, 8.33), (-6.22, 8.22), (-6.11, 8.11), (-6.0, 8.0), (-6.0, 8.0), (-5.89, 7.89), (-5.78, 7.78), (-5.67, 7.67), (-5.56, 7.56), (-5.44, 7.44), (-5.33, 7.33), (-5.22, 7.22), (-5.11, 7.11), (-5.0, 7.0), (-5.0, 7.0), (-5.0, 6.89), (-5.0, 6.78), (-5.0, 6.67), (-5.0, 6.56), (-5.0, 6.44), (-5.0, 6.33), (-5.0, 6.22), (-5.0, 6.11), (-5.0, 6.0), (-5.0, 6.0), (-5.11, 5.89), (-5.22, 5.78), (-5.33, 5.67), (-5.44, 5.56), (-5.56, 5.44), (-5.67, 5.33), (-5.78, 5.22), (-5.89, 5.11), (-6.0, 5.0), (-6.0, 5.0), (-6.11, 5.0), (-6.22, 5.0), (-6.33, 5.0), (-6.44, 5.0), (-6.56, 5.0), (-6.67, 5.0), (-6.78, 5.0), (-6.89, 5.0), (-7.0, 5.0), (-7.0, 5.0), (-6.89, 4.89), (-6.78, 4.78), (-6.67, 4.67), (-6.56, 4.56), (-6.44, 4.44), (-6.33, 4.33), (-6.22, 4.22), (-6.11, 4.11), (-6.0, 4.0), (-6.0, 4.0), (-6.0, 4.11), (-6.0, 4.22), (-6.0, 4.33), (-6.0, 4.44), (-6.0, 4.56), (-6.0, 4.67), (-6.0, 4.78), (-6.0, 4.89), (-6.0, 5.0), (-6.0, 5.0), (-5.89, 4.89), (-5.78, 4.78), (-5.67, 4.67), (-5.56, 4.56), (-5.44, 4.44), (-5.33, 4.33), (-5.22, 4.22), (-5.11, 4.11), (-5.0, 4.0), (-5.0, 4.0), (-5.0, 3.89), (-5.0, 3.78), (-5.0, 3.67), (-5.0, 3.56), (-5.0, 3.44), (-5.0, 3.33), (-5.0, 3.22), (-5.0, 3.11), (-5.0, 3.0), (-5.0, 3.0), (-4.89, 2.89), (-4.78, 2.78), (-4.67, 2.67), (-4.56, 2.56), (-4.44, 2.44), (-4.33, 2.33), (-4.22, 2.22), (-4.11, 2.11), (-4.0, 2.0), (-4.0, 2.0), (-4.0, 2.11), (-4.0, 2.22), (-4.0, 2.33), (-4.0, 2.44), (-4.0, 2.56), (-4.0, 2.67), (-4.0, 2.78), (-4.0, 2.89), (-4.0, 3.0), (-4.0, 3.0), (-4.0, 3.11), (-4.0, 3.22), (-4.0, 3.33), (-4.0, 3.44), (-4.0, 3.56), (-4.0, 3.67), (-4.0, 3.78), (-4.0, 3.89), (-4.0, 4.0), (-4.0, 4.0), (-4.11, 4.11), (-4.22, 4.22), (-4.33, 4.33), (-4.44, 4.44), (-4.56, 4.56), (-4.67, 4.67), (-4.78, 4.78), (-4.89, 4.89), (-5.0, 5.0), (-5.0, 5.0), (-5.0, 5.11), (-5.0, 5.22), (-5.0, 5.33), (-5.0, 5.44), (-5.0, 5.56), (-5.0, 5.67), (-5.0, 5.78), (-5.0, 5.89), (-5.0, 6.0), (-5.0, 6.0), (-4.89, 6.11), (-4.78, 6.22), (-4.67, 6.33), (-4.56, 6.44), (-4.44, 6.56), (-4.33, 6.67), (-4.22, 6.78), (-4.11, 6.89), (-4.0, 7.0), (-4.0, 7.0), (-3.89, 7.0), (-3.78, 7.0), (-3.67, 7.0), (-3.56, 7.0), (-3.44, 7.0), (-3.33, 7.0), (-3.22, 7.0), (-3.11, 7.0), (-3.0, 7.0), (-3.0, 7.0), (-2.89, 7.0), (-2.78, 7.0), (-2.67, 7.0), (-2.56, 7.0), (-2.44, 7.0), (-2.33, 7.0), (-2.22, 7.0), (-2.11, 7.0), (-2.0, 7.0), (-2.0, 7.0), (-1.89, 7.0), (-1.78, 7.0), (-1.67, 7.0), (-1.56, 7.0), (-1.44, 7.0), (-1.33, 7.0), (-1.22, 7.0), (-1.11, 7.0), (-1.0, 7.0), (-1.0, 7.0), (-0.89, 7.0), (-0.78, 7.0), (-0.67, 7.0), (-0.56, 7.0), (-0.44, 7.0), (-0.33, 7.0), (-0.22, 7.0), (-0.11, 7.0), (0.0, 7.0), (0.0, 7.0), (0.0, 6.89), (0.0, 6.78), (0.0, 6.67), (0.0, 6.56), (0.0, 6.44), (0.0, 6.33), (0.0, 6.22), (0.0, 6.11), (0.0, 6.0), (0.0, 6.0), (-0.11, 6.0), (-0.22, 6.0), (-0.33, 6.0), (-0.44, 6.0), (-0.56, 6.0), (-0.67, 6.0), (-0.78, 6.0), (-0.89, 6.0), (-1.0, 6.0), (-1.0, 6.0), (-1.11, 6.0), (-1.22, 6.0), (-1.33, 6.0), (-1.44, 6.0), (-1.56, 6.0), (-1.67, 6.0), (-1.78, 6.0), (-1.89, 6.0), (-2.0, 6.0), (-2.0, 6.0), (-2.11, 6.0), (-2.22, 6.0), (-2.33, 6.0), (-2.44, 6.0), (-2.56, 6.0), (-2.67, 6.0), (-2.78, 6.0), (-2.89, 6.0), (-3.0, 6.0), (-3.0, 6.0), (-3.11, 6.0), (-3.22, 6.0), (-3.33, 6.0), (-3.44, 6.0), (-3.56, 6.0), (-3.67, 6.0), (-3.78, 6.0), (-3.89, 6.0), (-4.0, 6.0), (-4.0, 6.0), (-4.11, 6.11), (-4.22, 6.22), (-4.33, 6.33), (-4.44, 6.44), (-4.56, 6.56), (-4.67, 6.67), (-4.78, 6.78), (-4.89, 6.89), (-5.0, 7.0), (-5.0, 7.0), (-5.0, 6.89), (-5.0, 6.78), (-5.0, 6.67), (-5.0, 6.56), (-5.0, 6.44), (-5.0, 6.33), (-5.0, 6.22), (-5.0, 6.11), (-5.0, 6.0), (-5.0, 6.0), (-4.89, 5.89), (-4.78, 5.78), (-4.67, 5.67), (-4.56, 5.56), (-4.44, 5.44), (-4.33, 5.33), (-4.22, 5.22), (-4.11, 5.11), (-4.0, 5.0), (-4.0, 5.0), (-3.89, 4.89), (-3.78, 4.78), (-3.67, 4.67), (-3.56, 4.56), (-3.44, 4.44), (-3.33, 4.33), (-3.22, 4.22), (-3.11, 4.11), (-3.0, 4.0), (-3.0, 4.0), (-3.0, 3.89), (-3.0, 3.78), (-3.0, 3.67), (-3.0, 3.56), (-3.0, 3.44), (-3.0, 3.33), (-3.0, 3.22), (-3.0, 3.11), (-3.0, 3.0), (-3.0, 3.0), (-3.0, 2.89), (-3.0, 2.78), (-3.0, 2.67), (-3.0, 2.56), (-3.0, 2.44), (-3.0, 2.33), (-3.0, 2.22), (-3.0, 2.11), (-3.0, 2.0), (-3.0, 2.0), (-3.0, 1.89), (-3.0, 1.78), (-3.0, 1.67), (-3.0, 1.56), (-3.0, 1.44), (-3.0, 1.33), (-3.0, 1.22), (-3.0, 1.11), (-3.0, 1.0), (-3.0, 1.0), (-3.0, 0.89), (-3.0, 0.78), (-3.0, 0.67), (-3.0, 0.56), (-3.0, 0.44), (-3.0, 0.33), (-3.0, 0.22), (-3.0, 0.11), (-3.0, 0.0), (-3.0, 0.0), (-2.89, 0.0), (-2.78, 0.0), (-2.67, 0.0), (-2.56, 0.0), (-2.44, 0.0), (-2.33, 0.0), (-2.22, 0.0), (-2.11, 0.0), (-2.0, 0.0), (-2.0, 0.0), (-2.0, 0.11), (-2.0, 0.22), (-2.0, 0.33), (-2.0, 0.44), (-2.0, 0.56), (-2.0, 0.67), (-2.0, 0.78), (-2.0, 0.89), (-2.0, 1.0), (-2.0, 1.0), (-1.89, 1.11), (-1.78, 1.22), (-1.67, 1.33), (-1.56, 1.44), (-1.44, 1.56), (-1.33, 1.67), (-1.22, 1.78), (-1.11, 1.89), (-1.0, 2.0), (-1.0, 2.0), (-0.89, 2.0), (-0.78, 2.0), (-0.67, 2.0), (-0.56, 2.0), (-0.44, 2.0), (-0.33, 2.0), (-0.22, 2.0), (-0.11, 2.0), (0.0, 2.0), (0.0, 2.0), (0.0, 2.11), (0.0, 2.22), (0.0, 2.33), (0.0, 2.44), (0.0, 2.56), (0.0, 2.67), (0.0, 2.78), (0.0, 2.89), (0.0, 3.0), (0.0, 3.0), (0.0, 3.11), (0.0, 3.22), (0.0, 3.33), (0.0, 3.44), (0.0, 3.56), (0.0, 3.67), (0.0, 3.78), (0.0, 3.89), (0.0, 4.0), (0.0, 4.0), (0.0, 4.11), (0.0, 4.22), (0.0, 4.33), (0.0, 4.44), (0.0, 4.56), (0.0, 4.67), (0.0, 4.78), (0.0, 4.89), (0.0, 5.0), (0.0, 5.0), (-0.11, 5.0), (-0.22, 5.0), (-0.33, 5.0), (-0.44, 5.0), (-0.56, 5.0), (-0.67, 5.0), (-0.78, 5.0), (-0.89, 5.0), (-1.0, 5.0), (-1.0, 5.0), (-1.11, 5.0), (-1.22, 5.0), (-1.33, 5.0), (-1.44, 5.0), (-1.56, 5.0), (-1.67, 5.0), (-1.78, 5.0), (-1.89, 5.0), (-2.0, 5.0), (-2.0, 5.0), (-2.11, 5.0), (-2.22, 5.0), (-2.33, 5.0), (-2.44, 5.0), (-2.56, 5.0), (-2.67, 5.0), (-2.78, 5.0), (-2.89, 5.0), (-3.0, 5.0), (-3.0, 5.0), (-2.89, 4.89), (-2.78, 4.78), (-2.67, 4.67), (-2.56, 4.56), (-2.44, 4.44), (-2.33, 4.33), (-2.22, 4.22), (-2.11, 4.11), (-2.0, 4.0), (-2.0, 4.0), (-2.0, 3.89), (-2.0, 3.78), (-2.0, 3.67), (-2.0, 3.56), (-2.0, 3.44), (-2.0, 3.33), (-2.0, 3.22), (-2.0, 3.11), (-2.0, 3.0), (-2.0, 3.0), (-2.0, 2.89), (-2.0, 2.78), (-2.0, 2.67), (-2.0, 2.56), (-2.0, 2.44), (-2.0, 2.33), (-2.0, 2.22), (-2.0, 2.11), (-2.0, 2.0), (-2.0, 2.0), (-1.89, 2.22), (-1.78, 2.44), (-1.67, 2.67), (-1.56, 2.89), (-1.44, 3.11), (-1.33, 3.33), (-1.22, 3.56), (-1.11, 3.78), (-1.0, 4.0), (-1.0, 4.0), (-1.0, 3.89), (-1.0, 3.78), (-1.0, 3.67), (-1.0, 3.56), (-1.0, 3.44), (-1.0, 3.33), (-1.0, 3.22), (-1.0, 3.11), (-1.0, 3.0)]
cell_numb = 0
targetX = list[cell_numb][0]
targetY = list[cell_numb][1]
time_of_last_change = robot.getTime()
prob_bound = 0.95
wait_time = 4
################

while (robot.step(timestep) != -1):

    led_state = int(robot.getTime()) % 2
    front_left_led.set(led_state)
    front_right_led.set(int(not(led_state)))

    roll = imu.getRollPitchYaw()[0] + M_PI / 2.0
    pitch = imu.getRollPitchYaw()[1]
    yaw = compass.getValues()[0]
    roll_acceleration = gyro.getValues()[0]
    pitch_acceleration = gyro.getValues()[1]
    
    xGPS = gps.getValues()[2]
    yGPS = gps.getValues()[0]
    zGPS = gps.getValues()[1]
        
    #####
    # This is the controller code.
    #####
    current_time = robot.getTime()
    if ((xGPS >= list[cell_numb][0]*prob_bound) or \
       (xGPS <= list[cell_numb][0]*prob_bound)) and \
       ((yGPS >= list[cell_numb][1]*prob_bound) or \
       (yGPS <= list[cell_numb][1]*prob_bound)):  
        if (current_time - time_of_last_change) > wait_time:
            print(f"before: {targetX, targetY}")
            cell_numb += 1
            targetX = list[cell_numb][0]
            targetY = list[cell_numb][1]
            time_of_last_change = robot.getTime()
            print(f"after: {targetX, targetY}")
    else:
        None

    vertical_input = throttlePID(zGPS)
    yaw_input = yawPID(yaw)

    rollPID.setpoint = targetX
    pitchPID.setpoint = targetY
    
    roll_input = float(params["k_roll_p"]) * roll + roll_acceleration + rollPID(xGPS)
    pitch_input = float(params["k_pitch_p"]) * pitch - pitch_acceleration + pitchPID(-yGPS)

    front_left_motor_input = float(params["k_vertical_thrust"]) + vertical_input - roll_input - pitch_input + yaw_input
    front_right_motor_input = float(params["k_vertical_thrust"]) + vertical_input + roll_input - pitch_input - yaw_input
    rear_left_motor_input = float(params["k_vertical_thrust"]) + vertical_input - roll_input + pitch_input - yaw_input
    rear_right_motor_input = float(params["k_vertical_thrust"]) + vertical_input + roll_input + pitch_input + yaw_input

    mavic2proHelper.motorsSpeed(robot, front_left_motor_input, -front_right_motor_input, -rear_left_motor_input, rear_right_motor_input)
